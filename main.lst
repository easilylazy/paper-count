C51 COMPILER V9.00   MAIN                                                                  04/20/2021 20:40:18 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\output\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE src\main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\main.lst) OBJECT(.\output\main
                    -.obj)

line level    source

   1          # include <reg52.h>
   2          # include "include/utils.h"
   3          # include "include/kalman.h" 
   4          # define uint unsigned int
   5          uchar flag,a,i;
   6          unsigned int beat;              //计时器T2溢出次数，当前为50ms一次
   7          
   8          unsigned int round;      //计数器T0溢出次数，每个周期重新计数
   9          
  10          sbit led1=P1^0 ;
  11          sbit watch=P1^2;
  12          sbit input=P3^7;
  13          sbit ticker=P0^0;       
  14          sbit debugMode=P3^3;
  15          sbit startMode=P3^2;
  16          sbit testPin=P0^0;
  17          void init(){
  18   1              TMOD=0X25;               //T1 TIMER T0 COUNT
  19   1              TH1=0XFD;
  20   1              TL1=0XFD;
  21   1      
  22   1              RCAP2H=0X004C;
  23   1              RCAP2L=0X0000;
  24   1              resetT0();
  25   1              TR2=1;
  26   1              TR1=1;
  27   1              TR0=1;
  28   1              REN=1;
  29   1              SM0=0;
  30   1              SM1=1;
  31   1              EA=1;
  32   1              ES=1;
  33   1      
  34   1              ET0=1;            // T0溢出中断，精确计数次数   
  35   1              ET2=1;            // 允许T2中断，以通过自动重装计时
  36   1      
  37   1              EX1=1;  // 外部中断1：校正模式
  38   1              EX0=1;  // 外部中断0：启动模式
  39   1      
  40   1              IT1=0;
  41   1              IT0=1;
  42   1      
  43   1      }
  44          
  45          
  46          
  47          void watchChange(){
  48   1              
  49   1              int i;
  50   1              if(input==0){
  51   2                      // sleep(10);
  52   2                       //if(input==0){           
  53   2                              watch=~watch;
  54   2                              while(!input); // wait for key 
C51 COMPILER V9.00   MAIN                                                                  04/20/2021 20:40:18 PAGE 2   

  55   2      
  56   2                              watch=~watch;
  57   2      //                      for(i=0;i<0;i++){
  58   2      //                                              watch=~watch;
  59   2      //                      }
  60   2              //       }      
  61   2              }
  62   1      }
*** WARNING C280 IN LINE 49 OF SRC\MAIN.C: 'i': unreferenced local variable
  63          void main(void){
  64   1              unsigned int last_beat=0,seconds=0;
  65   1              unsigned int cnt_sum;//,foo=0X0001,bar=0X0002;
  66   1              unsigned int period =5;
  67   1              double freq;
  68   1      
  69   1              
  70   1              
  71   1              init();
  72   1              flag=0;
  73   1              //test_filter();        
  74   1              init_filter();
  75   1              while(1){
  76   2                      //input=~input;
  77   2                      led1=0;
  78   2                      watchChange();
  79   2                      if (flag==1){
  80   3                              ES=0;
  81   3                              processInput(a);
  82   3                              if(a=='p'){
  83   4                                      output_string("TH0: ");
  84   4                                      output_int(TH0);
  85   4      
  86   4                                      output_string("TH0*256: ");
  87   4                                      output_int(TH0*256);
  88   4      
  89   4                                      output_string("TH0<<: ");
  90   4                                      output_int(TH0>>8);
  91   4      
  92   4                                      output_string("TL0: ");
  93   4                                      output_int(TL0);
  94   4                              }else if(a=='t'){
  95   4                                      output_string(" V ");
  96   4                                      output_int(testPin);
  97   4                              }
  98   3                                                      
  99   3                              ES=1;
 100   3                              flag=0;
 101   3      
 102   3                      }
 103   2                      if(last_beat!=beat&&beat%20==1){
 104   3                              ES=0;
 105   3                              seconds++;
 106   3                              if (seconds%(1*period)==1){
 107   4                                      cnt_sum= 256*round+TH0;
 108   4                                      //(TH0<<8)+TL0;
 109   4                                      
 110   4                                      freq=(double)cnt_sum/period;
 111   4      
 112   4                                      output_string("sum: ");
 113   4                                      output_int(cnt_sum);
 114   4      
 115   4                                      output_string("freq: ");
C51 COMPILER V9.00   MAIN                                                                  04/20/2021 20:40:18 PAGE 3   

 116   4                                      output_int((int)freq);
 117   4      
 118   4                                      output_string("filter: ");
 119   4                                      output_int((int)getXn());
 120   4      
 121   4                                      output_string("round: ");
 122   4                                      output_int(round);
 123   4                              
 124   4                                      predict();
 125   4                                      update(freq);
 126   4                                      
 127   4                                      // reset
 128   4                                      resetT0();
 129   4                                      round=0;
 130   4                              }
 131   3                              ES=1;
 132   3                              last_beat=beat;
 133   3                      }
 134   2      
 135   2              }
 136   1      }       
 137          
 138          // T0 溢出， 统计+1
 139          void overflow() interrupt 1{
 140   1              output_string(" OVERFLOW ");
 141   1              round++;        
 142   1              TF1=0;   
 143   1      }
 144          // INT0下降沿或低电平，启动
 145          void start() interrupt 0{
 146   1              sleep(10);
 147   1              output_string(" start mode ");
 148   1              while(!INT0);
 149   1              output_string(" start ");
 150   1              
 151   1      }
 152          // INT1下降沿或低电平，校正
 153          void debug() interrupt 2{
 154   1              output_string(" debug mode ");
 155   1              while(!INT1);
 156   1              output_string(" debug  ");
 157   1      }
 158          
 159          void refresh() interrupt 4{
 160   1      
 161   1              RI=0;
 162   1              a=SBUF;
 163   1              flag=1;
 164   1                       
 165   1      }       
 166          
 167          void timer_50ms() interrupt 5{
 168   1      
 169   1              TF2=0;
 170   1              beat++;  
 171   1      
 172   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    722    ----
   CONSTANT SIZE    =    118    ----
C51 COMPILER V9.00   MAIN                                                                  04/20/2021 20:40:18 PAGE 4   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
